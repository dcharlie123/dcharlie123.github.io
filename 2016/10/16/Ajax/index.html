<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ajax | dcharlie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
  
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">首页</a>
    
  
    
      <a href="/archives">归档</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2016/10/16/Ajax/">Ajax</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">October 16 2016</p>
  </section>

  <section class="article-entry">
    <p>##Ajax</p>
<h3 id="一、js原生Ajax"><a href="#一、js原生Ajax" class="headerlink" title="一、js原生Ajax"></a>一、js原生Ajax</h3><h4 id="1-创建"><a href="#1-创建" class="headerlink" title="1.创建"></a>1.创建</h4><p>IE7及其以上版本用<code>var oAjax=new XMLHttpRequest();</code><br>IE6用<code>var oAjax=new ActiveXObject(&#39;Microsoft.XMLHTTP&#39;);</code></p>
<h4 id="2-连接和发送"><a href="#2-连接和发送" class="headerlink" title="2.连接和发送"></a>2.连接和发送</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oAjax.open(type,url,<span class="literal">true</span>)</div></pre></td></tr></table></figure>
<p>1.要发送的请求类型（get，post等）<br></p>
<p><backquote></backquote></p>
<h6 id="get方法："><a href="#get方法：" class="headerlink" title="get方法："></a>get方法：</h6><pre><code>1.缓存 在url？后面连接一个随机数，时间戳
2.乱码 编码encodeURI
</code></pre><p><br><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oAjax.open(<span class="string">'get'</span>,<span class="string">'2.get.php?username='</span>+<span class="built_in">encodeURI</span>(<span class="string">'刘伟'</span>)+<span class="string">'&amp;age=30&amp;'</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),<span class="literal">true</span>);</div></pre></td></tr></table></figure></p>
<p>2.请求的url<br><br>3.是否异步发送<br><br>oAjax.send() 方法接收一个参数，作为请求主体发送的数据。如果不需要通过请求主体发送数据，这里必须传入 null ，因为这个参数对有些浏览器来说是必需的。调用 send() 之后，请求就会被分派到服务器。</p>
<h4 id="3-接收"><a href="#3-接收" class="headerlink" title="3.接收"></a>3.接收</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">oAjax.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">do</span> something</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="完整封装"><a href="#完整封装" class="headerlink" title="完整封装"></a>完整封装</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">ajax(&#123;</div><div class="line">        <span class="attr">url</span>: <span class="string">"./TestXHR.aspx"</span>,              <span class="comment">//请求地址</span></div><div class="line">        type: <span class="string">"POST"</span>,                       <span class="comment">//请求方式</span></div><div class="line">        data: &#123; <span class="attr">name</span>: <span class="string">"super"</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,        <span class="comment">//请求参数</span></div><div class="line">        dataType: <span class="string">"json"</span>,</div><div class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">response, xml</span>) </span>&#123;</div><div class="line">            <span class="comment">// 此处放成功后执行的代码</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">fail</span>: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</div><div class="line">            <span class="comment">// 此处放失败后执行的代码</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">options</span>) </span>&#123;</div><div class="line">        options = options || &#123;&#125;;</div><div class="line">        options.type = (options.type || <span class="string">"GET"</span>).toUpperCase();</div><div class="line">        options.dataType = options.dataType || <span class="string">"json"</span>;</div><div class="line">        <span class="keyword">var</span> params = formatParams(options.data);</div><div class="line"></div><div class="line"><span class="comment">//创建 - 非IE6 - 第一步</span></div><div class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</div><div class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//IE6及其以下版本浏览器</span></div><div class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>);</div><div class="line">        &#125;</div><div class="line"><span class="comment">//连接 和 发送 - 第二步</span></div><div class="line">        <span class="keyword">if</span> (options.type == <span class="string">"GET"</span>) &#123;</div><div class="line">            xhr.open(<span class="string">"GET"</span>, options.url + <span class="string">"?"</span> + params, <span class="literal">true</span>);</div><div class="line">            xhr.send(<span class="literal">null</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.type == <span class="string">"POST"</span>) &#123;</div><div class="line">            xhr.open(<span class="string">"POST"</span>, options.url, <span class="literal">true</span>);</div><div class="line">            <span class="comment">//设置表单提交时的内容类型</span></div><div class="line">            xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</div><div class="line">            xhr.send(params);</div><div class="line">        &#125;</div><div class="line"></div><div class="line"><span class="comment">//接收 - 第三步</span></div><div class="line">        xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</div><div class="line">                <span class="keyword">var</span> status = xhr.status;</div><div class="line">                <span class="keyword">if</span> (status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>) &#123;</div><div class="line">                    options.success &amp;&amp; options.success(xhr.responseText, xhr.responseXML);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    options.fail &amp;&amp; options.fail(status);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment">//格式化参数</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">formatParams</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> arr = [];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> data) &#123;</div><div class="line">            arr.push(<span class="built_in">encodeURIComponent</span>(name) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(data[name]));</div><div class="line">        &#125;</div><div class="line">        arr.push((<span class="string">"v="</span> + <span class="built_in">Math</span>.random()).replace(<span class="string">"."</span>,<span class="string">""</span>));</div><div class="line">        <span class="keyword">return</span> arr.join(<span class="string">"&amp;"</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="二、jquery-Ajax"><a href="#二、jquery-Ajax" class="headerlink" title="二、jquery Ajax"></a>二、jquery Ajax</h3><p>一.load()方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$(selector).load(URL,[data],[callback],[type]);</div><div class="line">type:text|html|json|script</div></pre></td></tr></table></figure></p>
<h6 id="demo1："><a href="#demo1：" class="headerlink" title="demo1："></a>demo1：</h6><p>html部分：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div id=<span class="string">"div1"</span>&gt;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p>数据部分：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;h2&gt;jQuery and AJAX is FUN!!!&lt;/h2&gt;</div><div class="line">&lt;p id=<span class="string">"p1"</span>&gt;This is some text <span class="keyword">in</span> a paragraph.&lt;<span class="regexp">/p&gt;</span></div></pre></td></tr></table></figure></p>
<p>js部分：</p>
<h4 id="1-加载全部"><a href="#1-加载全部" class="headerlink" title="1.加载全部"></a>1.加载全部</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"#div1"</span>).load(<span class="string">"demo_test.txt"</span>);</div></pre></td></tr></table></figure>
<h4 id="2-加载指定"><a href="#2-加载指定" class="headerlink" title="2.加载指定"></a>2.加载指定</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"#div1"</span>).load(<span class="string">"demo_test.txt #p1"</span>);</div><div class="line">$(<span class="string">"#div1"</span>).load(<span class="string">'demo_test.txt'</span>,&#123;<span class="attr">type</span>:xxx&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</div></pre></td></tr></table></figure>
<pre><code>可选的 callback 参数规定当 load() 方法完成后所要允许的回调函数。回调函数可以设置不同的参数：
    responseTxt - 包含调用成功时的结果内容
    statusTXT - 包含调用的状态
    xhr - 包含 XMLHttpRequest 对象
</code></pre><h4 id="demo2："><a href="#demo2：" class="headerlink" title="demo2："></a>demo2：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"button"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  $(<span class="string">"#div1"</span>).load(<span class="string">"demo_test.txt"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">responseTxt,statusTxt,xhr</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(statusTxt==<span class="string">"success"</span>)</div><div class="line">      alert(<span class="string">"外部内容加载成功！"</span>);</div><div class="line">    <span class="keyword">if</span>(statusTxt==<span class="string">"error"</span>)</div><div class="line">      alert(<span class="string">"Error: "</span>+xhr.status+<span class="string">": "</span>+xhr.statusText);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>二.get()方法<br>    $.get(URL,callback);</p>
<pre><code> demo3：
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"button"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  $.get(<span class="string">"test.php"</span>,<span class="string">'url='</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data,status</span>)</span>&#123;</div><div class="line">    alert(<span class="string">"Data: "</span> + data + <span class="string">"\nStatus: "</span> + status);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>

 demo:
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	$(<span class="string">"input"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		$.get(<span class="string">'test.php?url=baidu.com'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">response,status,xhr</span>) </span>&#123;</div><div class="line">			$(<span class="string">'#box'</span>).html(response);</div><div class="line">		 &#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</code></pre><p>三.post()方法<br>    $.post(URL,data,callback);<br>    必需的 URL 参数规定您希望请求的 URL。<br>    可选的 data 参数规定连同请求发送的数据。<br>    可选的 callback 参数是请求成功后所执行的函数名。</p>
<pre><code>demo4：
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"button"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  $.post(<span class="string">"demo_test_post.asp"</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">"Donald Duck"</span>,</div><div class="line">    <span class="attr">city</span>:<span class="string">"Duckburg"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">data,status</span>)</span>&#123;</div><div class="line">    alert(<span class="string">"Data: "</span> + data + <span class="string">"\nStatus: "</span> + status);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>

demo:
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	$(<span class="string">"input"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		$.post(<span class="string">'test.php'</span>,&#123;</div><div class="line">			<span class="attr">url</span>:<span class="string">'baidu.com'</span><span class="comment">//post提交可以使用对象键值对</span></div><div class="line">		&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">response,status,xhr</span>) </span>&#123;</div><div class="line">		$(<span class="string">'#box'</span>).html(response);</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</code></pre><p>四.ajax()方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123;</div><div class="line">	<span class="attr">url</span>:url,</div><div class="line">	<span class="attr">type</span>:<span class="string">'post'</span>,</div><div class="line">	<span class="attr">data</span>:sendData,</div><div class="line">	<span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span>(data==<span class="string">'true'</span>)&#123;</div><div class="line"></div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ajaxStart(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">do</span> something;</div><div class="line">&#125;).ajaxStop(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">do</span> something;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<pre><code>表单获取用$(&apos;form&apos;).serialize();
</code></pre><p>#####——————————未能实际运用，理解不够深入所以写得有点乱，先贴代码以后再修改</p>
<p>#####——————————dcharlie123于2016年10月16日（草稿）</p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="/pic/blob/master/avatar.jpg" alt="avatar" />
    <div class="grid-item">
      <p class="title"> dcharlie </p>
      <p class="subtitle"> do sth what u like,f**k the rest.keep moving </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=##Ajax</p>
<h3 id="一"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://yoursite.com/2016/10/16/Ajax/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
